<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/public/assets/css/layui.css" type="text/css">
    <link rel="stylesheet" href="/public/assets/css/mypublic.css" type="text/css">
    <link rel="stylesheet" href="/public/assets/css/view.css" type="text/css" />
    <link rel="stylesheet" href="/public/assets/css/setting/approve.css?time=<?php echo time()?>" type="text/css">
    <script src="/public/assets/js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <title></title>
    <style>
        .loginOut {
            cursor: pointer;
        }
    </style>
</head>

<body class="">
    <div class="regHead ">
        <p class="font-20 ">必量家<span class="font-16">卖家申请中心</span></p>
        <div class="headmsg  clearfix">
            <p class="fl">你好,{$user_info['nickname']}</p>
            <p class="fl loginOut">退出</p>
            <img src="{$user_info['head_pic']}" alt="">
            <input type="hidden" id="islogin" value="{$user_info['islogin']}">
        </div>
    </div>
    <div class="rowrap">
        <div class=" rowbox">
            <div class="applybox">
                <h3>我要开店</h3>
                <div class="step ">
                        <ul class="clearfix">
                            <li class=" ">
                                <div class="stepWrap">
                                    <div class=" font-36">1</div>
                                    <div class="stepDetail">
                                        <p class=" font-13">阅读开店须知</p>
                                        <p class="font-13 stepmsg">确认自己符合规定</p>
    
                                    </div>
                                </div>
                            </li>
                            <li class="">
                                <div class="stepWrap">
                                    <div class=" font-36">2</div>
                                    <div class="stepDetail">
                                        <p class="font-13">入驻信息</p>
                                        <p class="font-13 stepmsg">企业店铺</p>
                                    </div>
                                </div>
                            </li>
                            <li class="">
                                <div class="stepWrap">
                                    <div class=" font-36">3</div>
                                    <div class="stepDetail">
                                        <p class="font-13">公司信息</p>
                                        <p class="font-13 stepmsg">填写公司信息</p>
                                    </div>
                                </div>
                            </li>
                            <li class="on">
                                <div class="stepWrap">
                                    <div class=" font-36">4</div>
                                    <div class="stepDetail">
                                        <p class="font-13">店铺信息</p>
                                        <p class="font-13 stepmsg">填写店铺信息</p>
                                    </div>
                                </div>
                            </li>
                            <li class="stepThree">
                                <div class="stepWrap">
                                    <div class=" font-36">5</div>
                                    <div class="stepDetail">
                                        <p class="font-13">审核</p>
                                        <p class="font-13 stepmsg">等待审核通过</p>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>

                <!-- 开店认证 -->
                <div class="authentication ">
                    <form class="layui-form" id="submit" method="post" action="">
                        <div class="authenTitle">
                            <span class="titleLeft lableleft font-18">店铺信息</span>
                            <!-- <span class="titleRight font-12">用于入驻过程中接收平台官方反馈的入驻通知，请务必填写正确</span> -->
                        </div>
                        <div class="inputbox mainmsg">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">店铺账号</label>
                                    <div class="layui-input-inline">
                                        <input type="text" id="seller_name" name="seller_name" lay-verify="" onblur="checkCompany(this)" autocomplete="off" class="layui-input" err_msg="0">
                                        <span></span>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-right:0">
                                    <label class="layui-form-label">店铺名称</label>
                                    <div class="layui-input-inline">
                                        <input type="text" id="store_name" name="store_name" lay-verify="" autocomplete="off" class="layui-input" onblur="checkEmpty(this,this.value,'store_name','店铺名称','');">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline" style="margin-right:0">
                                    <label class="layui-form-label">店铺所属分类</label>
                                    <div class="layui-input-inline">
                                        <select name="sc_id" id="sc_id" lay-verify="required" lay-search="">
                                            <option value="">请选择分类</option>
                                            <foreach name="store_class" item="v" key="k">
                                                <option value="{$k}">{$v}</option>
                                            </foreach>
                                        </select>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                      
                        <div class="authenTitle">
                            <span class="titleLeft lableleft font-18">店铺经营信息</span>
                            <!-- <span class="titleRight font-12">请输入真实的信息</span> -->
                        </div>
                        <div class="inputbox ">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">店铺负责人</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="store_person_name" id="store_person_name" lay-verify="" autocomplete="off" class="layui-input"
                                            placeholder="" onblur="checkEmpty(this,this.value,'store_person_name','店铺负责人','');">
                                        <span></span>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-right:0">
                                    <label class="layui-form-label">负责人手机号码</label>
                                    <div class="layui-input-inline">
                                        <input type="tel" id="store_person_mobile" name="store_person_mobile" lay-verify="required|phone" autocomplete="off"
                                            class="layui-input" placeholder="" onblur="checkEmpty(this,this.value,'store_person_mobile','负责人手机号码','mobile');">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">负责人QQ号码</label>
                                    <div class="layui-input-inline">
                                        <input type="text" id="store_person_qq" name="store_person_qq" lay-verify="" autocomplete="off" class="layui-input"
                                            placeholder="" onblur="checkEmpty(this,this.value,'store_person_qq','负责人QQ号码','');">
                                        <span></span>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-right:0">
                                    <label class="layui-form-label">负责人邮箱</label>
                                    <div class="layui-input-inline">
                                        <input type="text" id="store_person_email" name="store_person_email" lay-verify="email" autocomplete="off"
                                            class="layui-input" placeholder="" onblur="checkEmpty(this,this.value,'store_person_email','负责人邮箱','email');">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                       
                        <div class="authenticationbtn">
                            <a href="{:url('reg/sellerRegThree')}" style="margin-right: 155px" class="btnNO arthenbtn">上一步</a>
                            <a href="javascript:void(0)" class="nextStep">审核</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="/public/assets/layui.all.js" type="text/javascript"></script>
    <script src="/public/assets/js/TouchSlide.1.1.js" type="text/javascript"></script>

</body>
<script>
    var layer;
    layui.use('upload', function () {
        var $ = layui.jquery
            , upload = layui.upload
            , laydate = layui.laydate,
            layer=layui.layer
        //日期范围
        laydate.render({
            elem: '#validity'
            , range: true
        });
        //普通图片上传
        var uploadInst = upload.render({
            elem: '#imgbtn'
            , url: '/upload/'
            // , auto: false
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('.upimg1').css("z-index", 1)
                    $('#demo1').attr('src', result); //图片链接（base64）

                });
            }
            , done: function (res) {
                //   //如果上传失败
                //   if(res.code > 0){
                //     return layer.msg('上传失败');
                //   }
                //上传成功
            }
            , error: function () {
                //演示失败状态，并实现重 传
                //   var demoText = $('#demoText');
                //   demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                //   demoText.find('.demo-reload').on('click', function(){
                //     uploadInst.upload();
                //   });
            }
        });


        //普通图片上传
        var uploadInst = upload.render({
            elem: '#imgbtn1'
            , url: '/upload/'
            // , auto: false
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('.upimg2').css("z-index", 1)
                    $('#demo2').attr('src', result); //图片链接（base64）

                });
            }
            , done: function (res) {
                //   //如果上传失败
                //   if(res.code > 0){
                //     return layer.msg('上传失败');
                //   }
                //上传成功
            }
            , error: function () {
                //演示失败状态，并实现重 传
                //   var demoText = $('#demoText');
                //   demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                //   demoText.find('.demo-reload').on('click', function(){
                //     uploadInst.upload();
                //   });
            }
        });
    })

    $(function () {
        $.ajax({
            url: "{:U('reg/getloginstatus')}",
            type: "POST",
            success: function (res) {
                if (res == false) {
                    $('.loginOut').html('');
                }
            }
        })
    })
    $('.loginOut').click(function () {
        $.ajax({
            url: "{:U('reg/loginstatusout')}",
            type: "POST",
            success: function (res) {
                if (res == true) {
                    alert('已退出账户');
                    window.location.reload();
                }
            }
        })
    })



    $('.nextStep').click(function () {
        var islogin = $('#islogin').val();
        if (islogin == 0) {
            alert('请先登录');
            window.location.href = 'loginNew.html';
            return false;
        }

        if ($("#seller_name").val() == '') {
            // $("#corpName").focus();
            $("#seller_name").css("border","1px solid #ff4c4c")
            $("#seller_name").next().html("店铺账号不能为空")
            return;
        }else{
            $("#seller_name").css("border","1px solid #e6e6e6")
        }

        if ($("#store_name").val()=="") {
            $("#store_name").css("border","1px solid #ff4c4c")
            $("#store_name").next().html("店铺名称不能为空")
            return;
        }else{
            $("#store_name").css("border","1px solid #e6e6e6")
        }

        if ($("#sc_id").val()=="") {
            $("#sc_id").parent().find("span").html("请选择店铺所属分类")
            // $("#province").focus();
            $("#sc_id").next().css("border","1px solid #ff4c4c")
            return;
        }else{
            $("#sc_id").parent().find("span").html("")
            $("#sc_id").next().css("border","none")
        }

        if ($("#store_person_name").val()=="") {
            $("#store_person_name").parent().find("span").html("店铺负责人不能为空")
            // $("#company_type").focus();
            $("#store_person_name").css("border","1px solid #ff4c4c")
            return;
        }else{
            $("#store_person_name").css("border","1px solid #e6e6e6")
        }

        if ($("#store_person_mobile").val()=="") {
            $("#store_person_mobile").parent().find("span").html("负责人手机号码不能为空")
            // $("#company_type").focus();
            $("#store_person_mobile").css("border","1px solid #ff4c4c")
            return;
        }else{
            $("#store_person_mobile").css("border","1px solid #e6e6e6")
        }

        if ($("#store_person_qq").val()=="") {
            $("#store_person_qq").parent().find("span").html("负责人qq不能为空")
            // $("#company_type").focus();
            $("#store_person_qq").css("border","1px solid #ff4c4c")
            return;
        }else{
            $("#store_person_qq").css("border","1px solid #e6e6e6")
        }

        if ($("#store_person_email").val()=="") {
            $("#store_person_email").parent().find("span").html("负责人邮箱不能为空")
            // $("#company_type").focus();
            $("#store_person_email").css("border","1px solid #ff4c4c")
            return;
        }else{
            $("#store_person_email").css("border","1px solid #e6e6e6")
        }


        layer.msg("提交成功",{time:1000});
            $('#submit').submit();
    })

    var ret = 0;
    function checkEmpty(_this,value, id, msg, type) {
        console.log(_this)
        var _email = /^([a-zA-Z0-9]+[_|\_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        var _phone= /^((\+?[0-9]{2,4}\-[0-9]{3,4}\-)|([0-9]{3,4}\-))?([0-9]{7,8})(\-[0-9]+)?$/;
        var _mobile = /^1(3|5|6|7|8|9)\d{9}$/;
        if(value == "" ||  ($.trim(value)).length == 0){
            $(_this).next().html( "请填写" + msg);
            $(_this).css("border","1px solid #ff4c4c")
        }  else {
            if ((type == "email" && !(_email.test(value))) || (type == "phone" && !(_phone.test(value))) || (type == "mobile" && !(_mobile.test(value))) || (type == "zip" && !(_zip.test(value))) || (type == "positiveInteger" && !(_positiveInteger.test(value))) || (type == "money" && !(_money.test(value)))  || (type == "money1" && (!(value > 0) || !(_money1.test(value))))) {

                if (type == "positiveInteger") {

                    msg = msg + "(正整数)";
                } else if (type == "money") {
                    msg = msg + "(金额)";
                } else if (type == "money1") {
                    msg = msg + "(6位整数6位小数的金额)";
                }

                $(_this).next().html( "格式错误，请正确填写" + msg);
                // $(_this).css("border","1px solid #ff4c4c")

            } else {
                $(_this).next().html("");
                // $(_this).css("border","1px solid #e6e6e6")
                ret = 1;
            }
        }
        return ret;
    }

    function checkCompany(obj){
        if($(obj).val()==''){
            $(obj).next().html("不能为空")
            $(obj).css("border","1px solid #ff4c4c")
        }else{
            $(obj).next().html("")
            $(obj).css("border","1px solid #e6e6e6")
        }
        var url = "{:U('Reg/check_company')}";
        $.ajax({
            type : "POST",
            url  : url,
            data :{'company_name':$(obj).val()},
            error: function(request) {
                showErrorMsg("服务器繁忙, 请联系管理员!");
                return false;
            },
            success: function(res) {
                if(res == 'success'){
                    $(obj).attr('err_msg',0);
                }else{
                    $(obj).attr('err_msg',1);
                }
            }
        });

    }
</script>

</html>